<!DOCTYPE html>
<!-- saved from url=(0079)https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308 -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style data-merge-styles="true"></style>
    <style data-merge-styles="true"></style><style data-merge-styles="true"></style><meta name="viewport" content="width=device-width">
    <title>Lab 06: Creating Distributed Availability Groups</title>


    <script src="./Lab 06_ Creating Distributed Availability Groups_files/jquery.min.js.download" type="text/javascript"></script>
    <script src="./Lab 06_ Creating Distributed Availability Groups_files/Localize" type="text/javascript"></script>
    <script src="./Lab 06_ Creating Distributed Availability Groups_files/showdown.min.js.download"></script>
    <link rel="stylesheet" type="text/css" href="./Lab 06_ Creating Distributed Availability Groups_files/prettify.css">
    <script src="./Lab 06_ Creating Distributed Availability Groups_files/yaml.min.js.download"></script>
    <script src="./Lab 06_ Creating Distributed Availability Groups_files/LocalizeTo" type="text/javascript"></script>
    <link href="./Lab 06_ Creating Distributed Availability Groups_files/CloudClient.css" rel="stylesheet" type="text/css">

    <style type="text/css">
        body, html {
            font-family: Segoe UI,Tahoma,Verdana,Arial,sans-serif;
            font-size: 14px;
            padding: 0;
            margin: 0;
            background-color: #efefef;
            color: #000;
            height: 100%;
        }

        body {
            overflow: auto;
        }

        #outputWrapper {
            background-color: #efefef;
            min-height: 100%;
        }

        .instructionsPreview {
            padding: 20px;
            height: 100%;
        }

        .instructionsPreview .page {
            position: relative;
            display: block !important;
            padding: 15px 20px;
            background-color: #fff;
            page-break-after: always;
            min-height: 650px;
        }

        .instructionsPreview .page:not(:first-child) {
            margin-top: 20px;
        }

        @font-face {
            font-family: "lod";
            src: url("/fonts/lod.woff?v=18") format("woff"), url("/fonts/lod.ttf?v=18") format("truetype"), url("/fonts/lod.svg?v=18") format("svg");
        }

        .editLink:before {
            content: "\E70F";
            font-family: "lod";
            margin-right: 4px;
            display: inline-block;
        }

        @media print {
            body, html {
                height: auto;
            }

            body {
                -webkit-print-color-adjust: exact;
            }

            div {
                page-break-inside: avoid;
            }

            #outputWrapper {
                background-color: transparent;
            }

            .instructionsPreview {
                padding: 0;
            }

                .instructionsPreview .page:not(:first-child) {
                    margin-top: 0px;
                }
        }

        @page {
            margin-left: 1.5cm;
            margin-right: 1.5cm;
            margin-top: 1.5cm;
            margin-bottom: 1.5cm;
        }
    </style>
    <link id="themeStylesheet" href="./Lab 06_ Creating Distributed Availability Groups_files/Blue.css" rel="stylesheet">

</head>
<body>
        <!-- <div style="padding:10px 20px;">
            <a class="editLink" href="https://labondemand.com/LabProfile/EditInstructions/162361?InstructionsSetId=258308">Edit</a>
        </div> -->

    <div id="outputWrapper">
        <div id="instructions" class="instructionsPreview instructions"><div class="page" id="page0"><h1 id="creating-distributed-availability-groups">Creating Distributed Availability Groups</h1>
<h2 id="introduction">Introduction</h2>
<p>During this lab, you will learn how to create a distributed availability group using TSQL.</p>
<h2 id="objectives">Objectives</h2>
<p>At the end of this lab, you will be able to:</p>
<ul>
<li>Validate all replicas have automatic seeding enabled</li>
<li>Create the Distributed Availability Group</li>
<li>Join a second AG to the DAG</li>
<li>Validate the secondary AG has copies of the primary AG databases</li>
<li>Failover a Distributed Availability Group </li>
</ul>
<h2 id="estimated-time">Estimated Time</h2>
<p>35 minutes</p>
<h2 id="logon-information">Logon Information</h2>
<p>Use the following credentials to login into virtual environment</p>
<ol>
<li><p>Connect to <strong><a href="https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308#" class="selectMachineLink icon-link special-action-link" data-data="252938">AlwaysOnClient</a></strong> as <strong><span class="typeText" title="Type Text">Administrator</span></strong> using <strong><span class="typeText" title="Type Text">Pa$$w0rd</span></strong> as the password.</p>
<blockquote class="hint">
  <p>Click the <strong><span class="typeText" title="Type Text">Type Text</span></strong> icon to enter the associated text into the virtual machine.</p>
</blockquote></li>
<li><p>Connect to <strong><a href="https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308#" class="selectMachineLink icon-link special-action-link" data-data="252935">AlwaysOnN1</a></strong> as <strong><span class="typeText" title="Type Text">CORPNET.CONTOSO.COM\Administrator</span></strong> using <strong><span class="typeText" title="Type Text">Pa$$w0rd</span></strong> as the password.</p>
<blockquote class="hint">
  <p>Click the <strong><span class="typeText" title="Type Text">Type Text</span></strong> icon to enter the associated text into the virtual machine.</p>
</blockquote></li>
<li><p>Connect to <strong><a href="https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308#" class="selectMachineLink icon-link special-action-link" data-data="252936">AlwaysOnN2</a></strong> as <strong><span class="typeText" title="Type Text">Administrator</span></strong> using <strong><span class="typeText" title="Type Text">Pa$$w0rd</span></strong> as the password.</p>
<blockquote class="hint">
  <p>Click the <strong><span class="typeText" title="Type Text">Type Text</span></strong> icon to enter the associated text into the virtual machine.</p>
</blockquote></li>
<li><p>Connect to <strong><a href="https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308#" class="selectMachineLink icon-link special-action-link" data-data="252937">AlwaysOnN3</a></strong> as <strong><span class="typeText" title="Type Text">Administrator</span></strong> using <strong><span class="typeText" title="Type Text">Pa$$w0rd</span></strong> as the password.</p>
<blockquote class="hint">
  <p>Click the <strong><span class="typeText" title="Type Text">Type Text</span></strong> icon to enter the associated text into the virtual machine.</p>
</blockquote></li>
<li><p>Connect to <strong><a href="https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308#" class="selectMachineLink icon-link special-action-link" data-data="252934">AlwaysOnDC</a></strong> as <strong><span class="typeText" title="Type Text">Administrator</span></strong> using <strong><span class="typeText" title="Type Text">Pa$$w0rd</span></strong> as the password.</p>
<blockquote class="hint">
  <p>Click the <strong><span class="typeText" title="Type Text">Type Text</span></strong> icon to enter the associated text into the virtual machine.</p>
</blockquote></li>
<li><p>Change the screen resolution if required.</p>
<blockquote class="hint">
  <p>You may want to adjust the screen resolution to your own preference. Do this by right-clicking on the desktop and choosing <strong>Screen resolution</strong> and clicking <strong>OK</strong> when finished.</p>
</blockquote></li>
</ol>
<blockquote class="note">
  <p>Screenshots in the lab instructions may appear with a lesser SQL version number than is installed in the lab environment where functionality is not affected. </p>
</blockquote>
</div><div class="page" id="page1">
<h1 id="exercise-1-validate-all-replicas-have-automatic-seeding-enabled">Exercise 1: Validate all replicas have automatic seeding enabled</h1>
<p>In this exercise, you will learn how to validate all replicas have automatic seeding enabled</p>
<hr>
<h3 id="tasks">Tasks</h3>
<ol class="taskList">
<li class="task-list-item" id="taskIndex0"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex0"><span></span></label> Login to the <strong><a href="https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308#" class="selectMachineLink icon-link special-action-link" data-data="252938">AlwaysOnClient</a></strong> virtual machine as <span class="typeText" title="Type Text"><strong>CORPNET\cluadmin</strong></span> using <strong><span class="typeText" title="Type Text">Pa$$w0rd</span></strong> as the password.</p>
<blockquote class="hint">
  <p>Click the <strong><span class="typeText" title="Type Text">Type Text</span></strong> icon to enter the associated text into the virtual machine.</p>
</blockquote></li>
<li class="task-list-item" id="taskIndex1"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex1"><span></span></label> Open <strong>SQL Server Management studio (SSMS)</strong>, and then click <strong>Connect</strong>.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0185.png"></p></li>
<li class="task-list-item" id="taskIndex2"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex2"><span></span></label> In <strong>Registered servers</strong>, expand <strong>Database Engine</strong> and navigate down to <strong>Local Server Groups</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0186.png"></p></li>
<li class="task-list-item" id="taskIndex3"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex3"><span></span></label> Right click <strong>Local Server Groups</strong> and select <strong>New Query</strong>.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0187.png"></p></li>
<li class="task-list-item" id="taskIndex4"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex4"><span></span></label> A new query window will appear. </p>
<blockquote class="note">
  <p>Notice the <strong>pink</strong> status bar at the bottom that says <strong>Connected. (5/5)</strong>. This means that whatever commands are issued in the query window, they will be executed to all five servers in the <strong>Local Server Groups</strong> list, namely: AlwaysOnN1 AlwaysOnN2 AlwaysOnN3 AlwaysOnN4 and AlwaysOnN5</p>
</blockquote>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0188.png"></p></li>
<li class="task-list-item" id="taskIndex5"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex5"><span></span></label> Type in the following TSQL, and press the <strong>F5</strong> key to execute or press the <strong>Execute</strong> button. </p>
<blockquote class="note">
  <p>This will query the <strong>sys.availability_replicas</strong> DMV to look at the seeding mode on all five replicas.</p>
</blockquote>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">SELECT seeding_mode_desc
    FROM sys</span><span class="pun">.</span><span class="pln">availability_replicas
    WHERE replica_server_name </span><span class="pun">=</span><span class="pln"> </span><span class="pun">@</span><span class="lit">@Servername</span></code></pre></li>
<li class="task-list-item" id="taskIndex6"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex6"><span></span></label> On the <strong>Results</strong> tab you should have 5 rows - one for each server. </p>
<blockquote class="knowledge">
  <p>They should all indicate <strong>AUTOMATIC</strong> for their <strong>seeding_mode_desc</strong>. This is a requirement for distributed availability groups.</p>
</blockquote><div class="moreKnowledge"><a href="https://labondemand.com/LabProfile/Instructions/162361?instructionsSetId=258308#" class="moreKnowledgeLink" style="display: none;">more...</a></div>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0189.png"></p></li>
<li class="task-list-item" id="taskIndex7"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex7"><span></span></label> Next, close this query window.</p></li>
<li class="task-list-item" id="taskIndex8"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex8"><span></span></label> When prompted to save the query, click <strong>No</strong>.</p></li>
</ol>
<h3 id="congratulations">Congratulations!</h3>
<p>You have successfully completed this exercise. Click <strong>Next</strong> to advance to the next exercise.</p>
</div><div class="page" id="page2">
<h1 id="exercise-2-create-the-distributed-availability-group">Exercise 2: Create the Distributed Availability Group</h1>
<p>In this exercise, you will learn how to create the Distributed Availability Group</p>
<hr>
<h3 id="tasks-1">Tasks</h3>
<ol class="taskList">
<li class="task-list-item" id="taskIndex9"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex9"><span></span></label> The next command needs to be executed on the primary replica of the "Primary Availability Group". In this case the primary availability group is AGCorp. It is not always clear which instance is the primary, so we will connect to its primary using the availability group listener for that availability group, <strong>AGCorpList</strong>.</p></li>
<li class="task-list-item" id="taskIndex10"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex10"><span></span></label> Click on the <strong>Connect</strong> button in the Object Explorer window as show in the screen caption. Select the <strong>Database Engine</strong> option.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0190.png"></p></li>
<li class="task-list-item" id="taskIndex11"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex11"><span></span></label> Enter the name of the availability group listener, <strong><span class="typeText" title="Type Text">AGCorpList</span></strong> and press the <strong>Connect</strong> button.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0191.png"></p></li>
<li class="task-list-item" id="taskIndex12"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex12"><span></span></label> Find <strong>AGCorpList</strong> in the list of instances in the Object Explorer, right click it and select <strong>New Query</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0192.png"></p></li>
<li class="task-list-item" id="taskIndex13"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex13"><span></span></label> In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">CREATE AVAILABILITY GROUP </span><span class="pun">[</span><span class="typ">AGCorpDistributed</span><span class="pun">]</span><span class="pln">
    WITH </span><span class="pun">(</span><span class="pln">DISTRIBUTED</span><span class="pun">)</span><span class="pln"> AVAILABILITY GROUP ON
    </span><span class="str">'AGCorp'</span><span class="pln"> WITH </span><span class="pun">(</span><span class="pln">
        LISTENER_URL </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tcp://AGCorpList.corpnet.contoso.com:5022'</span><span class="pun">,</span><span class="pln">
        AVAILABILITY_MODE </span><span class="pun">=</span><span class="pln"> ASYNCHRONOUS_COMMIT</span><span class="pun">,</span><span class="pln">
        FAILOVER_MODE </span><span class="pun">=</span><span class="pln"> MANUAL</span><span class="pun">,</span><span class="pln">
        SEEDING_MODE </span><span class="pun">=</span><span class="pln"> AUTOMATIC</span><span class="pun">),</span><span class="pln">
    </span><span class="str">'AGCorpDR'</span><span class="pln"> WITH </span><span class="pun">(</span><span class="pln">
        LISTENER_URL </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tcp://AGCorpDRList.corpnet.contoso.com:5022'</span><span class="pun">,</span><span class="pln">
        AVAILABILITY_MODE </span><span class="pun">=</span><span class="pln"> ASYNCHRONOUS_COMMIT</span><span class="pun">,</span><span class="pln">
        FAILOVER_MODE </span><span class="pun">=</span><span class="pln"> MANUAL</span><span class="pun">,</span><span class="pln">
        SEEDING_MODE </span><span class="pun">=</span><span class="pln"> AUTOMATIC</span><span class="pun">);</span><span class="pln">
GO</span></code></pre>
<p>Alternatively, you can open the file, <strong>CreateDAG.SQL</strong> located in the following path on the AlwaysOnClient virtual machine. <strong>Make sure the file is connected to AGCorpList</strong>.</p>
<p><strong>C:\Scripts\ Lab 06 – Creating Distributed Availability Groups</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0193.png" alt="image0193.png"></p>
<blockquote class="note">
  <p>The port used for each distributed availability group LISTENER_URL (in this example 5022 for both) is the same port that the mirroring endpoint is configured to listen on, not the port that the availability group listener listens on for client communications.  The LISTENER_URL tells the primary availability group where to send its traffic to the secondary availability group.</p>
</blockquote></li>
<li class="task-list-item" id="taskIndex14"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex14"><span></span></label> Verify the Messages tab indicated the commands completed successfully.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0194.png"></p></li>
</ol>
<h3 id="congratulations-1">Congratulations!</h3>
<p>You have successfully completed this exercise. Click <strong>Next</strong> to advance to the next exercise.</p>
</div><div class="page" id="page3">
<h1 id="exercise-3-join-a-second-availability-group-to-the-distributed-availability-group">Exercise 3: Join a second availability group to the distributed availability group</h1>
<p>In this exercise, you will learn how to join a second availability group to the distributed availability group</p>
<hr>
<h3 id="tasks-2">Tasks</h3>
<ol class="taskList">
<li class="task-list-item" id="taskIndex15"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex15"><span></span></label> For direct seeding, you must allow database creation on each secondary replica by calling ALTER AVAILABILITY GROUP with the GRANT CREATE ANY DATABASE option. In our case the secondary availability group is <strong>AGCorpDR</strong> and secondary replica is <strong>AlwaysOnN5</strong>. <strong>Connect</strong> to <strong>AlwaysonN5</strong> and in <strong>new query window</strong> execute the command </p>
<p><span class="typeText" title="Type Text">ALTER AVAILABILITY GROUP AGCorpDR GRANT CREATE ANY DATABASE</span></p></li>
<li class="task-list-item" id="taskIndex16"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex16"><span></span></label> The next command needs to be executed onto the <strong>primary</strong> replica of the "Secondary Availability Group" i.e. <strong>AGCorpDR</strong>. Connect to its primary replica using the availability group <strong>listener</strong> for that availability group, <strong>AGCorpDRList</strong>.</p></li>
<li class="task-list-item" id="taskIndex17"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex17"><span></span></label> Click on the <strong>Connect</strong> button in the Object Explorer window as show in the screen caption. Select the <strong>Database Engine</strong> option.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0190.png"></p></li>
<li class="task-list-item" id="taskIndex18"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex18"><span></span></label> Enter the name of the availability group listener, <span class="typeText" title="Type Text"><strong>AGCorpDRList</strong></span> and press the <strong>Connect</strong> button.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0195.png"></p></li>
<li class="task-list-item" id="taskIndex19"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex19"><span></span></label> Find <strong>AGCorpDRList</strong> in the list of instances in the Object Explorer, right click it and select <strong>New Query</strong>.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0196.png" alt="image0196.png"></p></li>
<li class="task-list-item" id="taskIndex20"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex20"><span></span></label> In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">ALTER AVAILABILITY GROUP </span><span class="pun">[</span><span class="typ">AGCorpDistributed</span><span class="pun">]</span><span class="pln">
JOIN AVAILABILITY GROUP ON
</span><span class="str">'AGCorp'</span><span class="pln"> WITH </span><span class="pun">(</span><span class="pln">
    LISTENER_URL </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tcp://AGCorpList.corpnet.contoso.com:5022'</span><span class="pun">,</span><span class="pln">
    AVAILABILITY_MODE </span><span class="pun">=</span><span class="pln"> ASYNCHRONOUS_COMMIT</span><span class="pun">,</span><span class="pln">
    FAILOVER_MODE </span><span class="pun">=</span><span class="pln"> MANUAL</span><span class="pun">,</span><span class="pln">
    SEEDING_MODE </span><span class="pun">=</span><span class="pln"> AUTOMATIC</span><span class="pun">),</span><span class="pln">
</span><span class="str">'AGCorpDR'</span><span class="pln"> WITH </span><span class="pun">(</span><span class="pln">
    LISTENER_URL </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tcp://AGCorpDRList.corpnet.contoso.com:5022'</span><span class="pun">,</span><span class="pln">
    AVAILABILITY_MODE </span><span class="pun">=</span><span class="pln"> ASYNCHRONOUS_COMMIT</span><span class="pun">,</span><span class="pln">
    FAILOVER_MODE </span><span class="pun">=</span><span class="pln"> MANUAL</span><span class="pun">,</span><span class="pln">
    SEEDING_MODE </span><span class="pun">=</span><span class="pln"> AUTOMATIC</span><span class="pun">);</span><span class="pln">
GO</span></code></pre>
<p>Alternatively, you can open the file, <strong>JoinDAG.SQL</strong> located in the following path on the AlwaysOnClient virtual machine. <strong>Make sure the file is connected to AGCorpDRList</strong>.</p>
<p><strong>C:\Scripts\ Lab 06 – Creating Distributed Availability Groups</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0197.png" alt="image0197.png"></p></li>
<li class="task-list-item" id="taskIndex21"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex21"><span></span></label> Verify the Messages tab indicated the commands completed successfully.</p></li>
<li class="task-list-item" id="taskIndex22"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex22"><span></span></label> Now verify the distributed availability group exists. Re-connect to <strong>AGCorpList</strong> in SSMS Object Explorer and navigate to <strong>Availability Groups</strong>.</p>
<p>Notice two things;</p>
<ol>
<li><p>Next to the availability group called <strong>AGCorpDistributed</strong>, it shows <strong>(Distributed)</strong></p></li>
<li><p>Under the Availability Replicas for the distributed AG, it shows a <strong>primary</strong> and a <strong>secondary</strong> <strong>Availability Group</strong> name, not replica server names.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0198.png" alt="image0198.png"></p></li></ol></li>
</ol>
<h3 id="congratulations-2">Congratulations!</h3>
<p>You have successfully completed this exercise. Click <strong>Next</strong> to advance to the next exercise.</p>
</div><div class="page" id="page4">
<h1 id="exercise-4-validate-the-secondary-ag-has-copies-of-the-primary-ag-databases">Exercise 4: Validate the secondary AG has copies of the primary AG databases</h1>
<p>In this exercise, you will learn how to validate the secondary AG has copies of the primary AG databases</p>
<hr>
<h3 id="tasks-3">Tasks</h3>
<ol class="taskList">
<li class="task-list-item" id="taskIndex23"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex23"><span></span></label> At the end of exercise 3, we joined the secondary availability group to the distributed availability group. Now we need to confirm the nodes in this availability group receive the databases that the primary availability group has.</p></li>
<li class="task-list-item" id="taskIndex24"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex24"><span></span></label> Connect to one of the two nodes in the secondary availability group, <strong>AlwaysOnN4</strong>.</p>
<p>Click on the <strong>Connect</strong> button in the Object Explorer window as show in the screen caption. Select the <strong>Database Engine</strong> option.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0190.png"></p></li>
<li class="task-list-item" id="taskIndex25"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex25"><span></span></label> Enter the name of the replica in the secondary availability group, <span class="typeText" title="Type Text"><strong>AlwaysOnN4</strong></span> and press the <strong>Connect</strong> button.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0199.png"></p></li>
<li class="task-list-item" id="taskIndex26"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex26"><span></span></label> Find <strong>AlwaysOnN4</strong> in the list of instances in the Object Explorer and navigate down to the <strong>Databases</strong> folder and expand it.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0200.png" alt="image0200.png"></p>
<blockquote class="note">
  <p>Depending on how long it takes you to open the connection to primary of the secondary AG , the state of the two databases highlighted could be "Synchronized", "Synchronizing", or "Not Synchronizing". Eventually they should show "Synchronized" as in the screen shot above.</p>
</blockquote></li>
<li class="task-list-item" id="taskIndex27"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex27"><span></span></label> Repeat steps 2 through 4 for <span class="typeText" title="Type Text"><strong>AlwaysOnN5</strong></span>. It should also show the two new databases, <strong>AdventureWorks</strong> and <strong>AdventureWorksDW</strong>.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0201.png" alt="image0201.png"></p></li>
<li class="task-list-item" id="taskIndex28"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex28"><span></span></label> What is the state of the two databases on AlwaysOnN5?     </p>
<p><input type="text" class="variableTextBox" data-name="AlwaysOnN5DatabaseState" maxlength="500" spellcheck="false" data-ms-editor="true">    </p>
<p><span class="variable" data-name="AlwaysOnN5DatabaseState">&lt;AlwaysOnN5DatabaseState&gt;</span></p>
<p>If different than AlwaysOnN4, can you explain why?  </p>
<p><input type="text" class="variableTextBox" data-name="DatabaseStateDifferences" maxlength="500" spellcheck="false" data-ms-editor="true">    </p>
<p><span class="variable" data-name="DatabaseStateDifferences">&lt;DatabaseStateDifferences&gt;</span></p>
<blockquote class="note">
  <p>In some cases, one of the databases may not get automatically created or ever reach a synchronized state. If that is the case, you can review the SQL Server error logs or the following DMVs in a query window:</p>
</blockquote>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">SELECT </span><span class="pun">*</span><span class="pln"> FROM sys</span><span class="pun">.</span><span class="pln">dm_hadr_physical_seeding_stats
SELECT </span><span class="pun">*</span><span class="pln"> FROM sys</span><span class="pun">.</span><span class="pln">dm_hadr_automatic_seeding</span></code></pre></li>
</ol>
<h3 id="congratulations-3">Congratulations!</h3>
<p>You have successfully completed this exercise. Click <strong>Next</strong> to advance to the next exercise.</p>
</div><div class="page" id="page5">
<h1 id="exercise-5-failover-distributed-availability-group">Exercise 5: Failover distributed availability group</h1>
<p>In this exercise, you will learn how to failover distributed availability group</p>
<hr>
<h3 id="tasks-4">Tasks</h3>
<ol class="taskList">
<li class="task-list-item" id="taskIndex29"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex29"><span></span></label> In the last exercise we verified the secondary availability group has copied our databases from the primary availability group and the databases are synchronized.  In this exercise we will failover from the primary availability group to the secondary availabilty group. </p>
<p>This next command needs to be executed on both the global primary, <strong>AGCorpList</strong>, and the forwarder, <strong>AGCorpDRList</strong>, to switch the distributed availability group to synchronous commit. </p></li>
<li class="task-list-item" id="taskIndex30"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex30"><span></span></label> Connect to the listener for the primary availability group, <strong>AGCorpList</strong>.</p>
<p>Click on the <strong>Connect</strong> button in the Object Explorer window as show in the screen caption. Select the <strong>Database Engine</strong> option.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0190.png"></p></li>
<li class="task-list-item" id="taskIndex31"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex31"><span></span></label> Enter the name of the availability group listener, <span class="typeText" title="Type Text"><strong>AGCorpList</strong></span> and press the <strong>Connect</strong> button.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0191.png"></p></li>
<li class="task-list-item" id="taskIndex32"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex32"><span></span></label> Find <strong>AGCorpList</strong> in the list of instances in the Object Explorer, right click it and select <strong>New Query</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0192.png"></p></li>
<li class="task-list-item" id="taskIndex33"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex33"><span></span></label> In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pun">--</span><span class="pln"> sets the distributed availability </span><span class="kwd">group</span><span class="pln"> to synchronous commit 
ALTER AVAILABILITY GROUP </span><span class="pun">[</span><span class="typ">AGCorpDistributed</span><span class="pun">]</span><span class="pln"> 
MODIFY 
AVAILABILITY GROUP ON
</span><span class="str">'AGCorp'</span><span class="pln"> WITH 
</span><span class="pun">(</span><span class="pln"> 
AVAILABILITY_MODE </span><span class="pun">=</span><span class="pln"> SYNCHRONOUS_COMMIT 
</span><span class="pun">),</span><span class="pln"> 
</span><span class="str">'AGCorpDR'</span><span class="pln"> WITH  
</span><span class="pun">(</span><span class="pln"> 
AVAILABILITY_MODE </span><span class="pun">=</span><span class="pln"> SYNCHRONOUS_COMMIT 
</span><span class="pun">);</span><span class="pln">
GO</span></code></pre>
<p>Alternatively, you can open the file, <strong>SetDAGSynchronous.SQL</strong> located in the following path on the AlwaysOnClient virtual machine. <strong>Make sure the file is connected to AGCorpList</strong>.</p>
<p><strong>C:\Scripts\ Lab 06 – Creating Distributed Availability Groups</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0202.png" alt="image0202.png"></p>
<blockquote class="note">
  <p>In a distributed availability group, the synchronization status between the two availability groups depends on the availability mode of both replicas. For synchronous commit mode, both the current primary availability group, and the current secondary availability group must have SYNCHRONOUS_COMMIT availability mode. For this reason, you must run the script above on both the global primary replica, and the forwarder.</p>
</blockquote></li>
<li class="task-list-item" id="taskIndex34"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex34"><span></span></label> Verify the Messages tab indicated the commands completed successfully.</p></li>
<li class="task-list-item" id="taskIndex35"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex35"><span></span></label>  Repeat steps 2 through 6 for <span class="typeText" title="Type Text"><strong>AGCorpDRList</strong></span> to set the secondary availability group to synchronous commit mode.</p></li>
<li class="task-list-item" id="taskIndex36"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex36"><span></span></label> Open a new query window and make sure you are connected to <strong>AGCorpList</strong>. </p></li>
<li class="task-list-item" id="taskIndex37"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex37"><span></span></label> On the global primary set the availability group role to secondary. </p>
<p>In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script: </p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">ALTER AVAILABILITY GROUP </span><span class="typ">AGCorpDistributed</span><span class="pln"> SET </span><span class="pun">(</span><span class="pln">ROLE </span><span class="pun">=</span><span class="pln"> SECONDARY</span><span class="pun">);</span><span class="pln">
GO</span></code></pre></li>
<li class="task-list-item" id="taskIndex38"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex38"><span></span></label> Verify the Messages tab indicated the commands completed successfully.</p></li>
<li class="task-list-item" id="taskIndex39"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex39"><span></span></label> Wait until the status of the distributed availability group has changed to SYNCHRONIZED and all replicas have the same last_hardened_lsn (per database). </p>
<p>Run the following query on both the global primary, which is the primary replica of the primary availability group, and the forwarder to check the synchronization_state_desc and last_hardened_lsn:</p>
<p>In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln"> </span><span class="pun">--</span><span class="pln"> </span><span class="typ">Run</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> query on the </span><span class="typ">Global</span><span class="pln"> </span><span class="typ">Primary</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> the forwarder
</span><span class="pun">--</span><span class="pln"> </span><span class="typ">Check</span><span class="pln"> the results to see </span><span class="kwd">if</span><span class="pln"> synchronization_state_desc </span><span class="kwd">is</span><span class="pln"> SYNCHRONIZED</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> the last_hardened_lsn </span><span class="kwd">is</span><span class="pln"> the same per      database on both the </span><span class="kwd">global</span><span class="pln"> primary </span><span class="kwd">and</span><span class="pln"> forwarder 
</span><span class="pun">--</span><span class="pln"> </span><span class="typ">If</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> rerun the query on both side every </span><span class="lit">5</span><span class="pln"> seconds </span><span class="kwd">until</span><span class="pln"> it </span><span class="kwd">is</span><span class="pln"> the </span><span class="kwd">case</span><span class="pln">
</span><span class="pun">--</span><span class="pln">
SELECT ag</span><span class="pun">.</span><span class="pln">name
   </span><span class="pun">,</span><span class="pln"> drs</span><span class="pun">.</span><span class="pln">database_id
   </span><span class="pun">,</span><span class="pln"> db_name</span><span class="pun">(</span><span class="pln">drs</span><span class="pun">.</span><span class="pln">database_id</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> database_name
   </span><span class="pun">,</span><span class="pln"> drs</span><span class="pun">.</span><span class="pln">group_id
   </span><span class="pun">,</span><span class="pln"> r</span><span class="pun">.</span><span class="pln">replica_server_name </span><span class="kwd">as</span><span class="pln"> replica_name
   </span><span class="pun">,</span><span class="pln"> drs</span><span class="pun">.</span><span class="pln">synchronization_state_desc
   </span><span class="pun">,</span><span class="pln"> drs</span><span class="pun">.</span><span class="pln">last_hardened_lsn  
FROM sys</span><span class="pun">.</span><span class="pln">dm_hadr_database_replica_states drs 
INNER JOIN sys</span><span class="pun">.</span><span class="pln">availability_groups ag 
    ON drs</span><span class="pun">.</span><span class="pln">group_id </span><span class="pun">=</span><span class="pln"> ag</span><span class="pun">.</span><span class="pln">group_id
INNER JOIN sys</span><span class="pun">.</span><span class="pln">availability_replicas r 
    ON drs</span><span class="pun">.</span><span class="pln">replica_id </span><span class="pun">=</span><span class="pln"> r</span><span class="pun">.</span><span class="pln">replica_id</span><span class="pun">;</span><span class="pln">
GO</span></code></pre>
<p>Alternatively, you can open the file, <strong>CheckLastHardenedLSN.SQL</strong> located in the following path on the AlwaysOnClient virtual machine. <strong>Make sure you run the  file connected to AGCorpList</strong>.</p>
<p><strong>C:\Scripts\ Lab 06 – Creating Distributed Availability Groups</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0203.png" alt="image0203.png"></p></li>
<li class="task-list-item" id="taskIndex40"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex40"><span></span></label> Verify the Messages tab indicated the commands completed successfully.</p></li>
<li class="task-list-item" id="taskIndex41"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex41"><span></span></label> Repeat step 11 thru 13 for <span class="typeText" title="Type Text"><strong>AGCorpDRList</strong></span></p></li>
<li class="task-list-item" id="taskIndex42"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex42"><span></span></label> Now that the distributed availability group is synchronized and all availability replicas have the same last_hardened_lsn we are ready to failover the distributed availability group. </p>
<p>Find <strong>AGCorpDRList</strong> in the list of instances in the Object Explorer, right click it and select <strong>New Query</strong>.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0196.png" alt="image0196.png"></p></li>
<li class="task-list-item" id="taskIndex43"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex43"><span></span></label> In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">ALTER AVAILABILITY GROUP </span><span class="typ">AGCorpDistributed</span><span class="pln"> FORCE_FAILOVER_ALLOW_DATA_LOSS</span><span class="pun">;</span><span class="pln">
GO</span></code></pre>
<p>After completing the steps above, the distributed availability group fails over without any data loss. If the availability groups are across a geographical distance that causes latency, change the availability mode back to <strong>ASYNCHRONOUS_COMMIT</strong>.  </p>
<p>To fail the distributed availability group back from AGCorpDistributed to AGCorpList repeat the above steps. </p>
<h3 id="congratulations-5">Congratulations!</h3></li>
</ol>
<p>You have successfully completed this exercise. Click <strong>Next</strong> to advance to the next exercise.</p>
</div><div class="page" id="page6">
<h1 id="exercise-6-monitor-distributed-availability-group-health">Exercise 6: Monitor distributed availability group health</h1>
<p>In this exercise, you will learn how to monitor distributed availability group health</p>
<hr>
<h3 id="tasks-5">Tasks</h3>
<ol class="taskList">
<li class="task-list-item" id="taskIndex44"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex44"><span></span></label> In exercise 4, we set the distributed availability group in synchronous commit mode and failed over to the secondary availability group.  In this exercise we will monitor the health of our distributed availability group.  </p>
<p>The distributed availability group is SQL Server-only-construct and is not seen in the WSFC cluster.  Also, in SQL Server Management Studio you will only see the existence of the distributed availability group and its replicas. The availability databases and availability group listeners are all empty.  This may change in future versions of Management Studio but for now we will monitor the health of our availability group using T-SQL scripts. </p></li>
<li class="task-list-item" id="taskIndex45"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex45"><span></span></label> Connect to the listener for the primary availability group, <strong>AGCorpList</strong>.</p>
<p>Click on the <strong>Connect</strong> button in the Object Explorer window as show in the screen caption. Select the <strong>Database Engine</strong> option.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0190.png"></p></li>
<li class="task-list-item" id="taskIndex46"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex46"><span></span></label> Enter the name of the availability group listener, <span class="typeText" title="Type Text"><strong>AGCorpList</strong></span> and press the <strong>Connect</strong> button.</p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0191.png">1. [] Find <strong>AGCorpList</strong> in the list of instances in the Object Explorer, right click it and select <strong>New Query</strong></p>
<p>
<img src="./Lab 06_ Creating Distributed Availability Groups_files/image0192.png"></p></li>
<li class="task-list-item" id="taskIndex47"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex47"><span></span></label> In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">SELECT 
    ag</span><span class="pun">.[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> AS </span><span class="pun">[</span><span class="typ">Distributed</span><span class="pln"> AG </span><span class="typ">Name</span><span class="pun">],</span><span class="pln"> 
    ag</span><span class="pun">.</span><span class="typ">Is_Distributed</span><span class="pun">,</span><span class="pln"> 
    ar</span><span class="pun">.</span><span class="pln">replica_server_name AS </span><span class="pun">[</span><span class="typ">Replica</span><span class="pln"> </span><span class="typ">Name</span><span class="pun">]</span><span class="pln">
FROM sys</span><span class="pun">.</span><span class="pln">availability_groups AS ag 
INNER JOIN sys</span><span class="pun">.</span><span class="pln">availability_replicas AS ar       
    ON ag</span><span class="pun">.</span><span class="pln">group_id </span><span class="pun">=</span><span class="pln"> ar</span><span class="pun">.</span><span class="pln">group_id
WHERE ag</span><span class="pun">.</span><span class="typ">Is_Distributed</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> 
GO</span></code></pre></li>
<li class="task-list-item" id="taskIndex48"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex48"><span></span></label> On the <strong>Results</strong> tab you should see two rows listing the name of your distributed availability group and the names of the replicas in the distributed availability group.</p></li>
<li class="task-list-item" id="taskIndex49"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex49"><span></span></label> Repeat steps 2 and 3 to connect to <strong>AGCorpList</strong> and open a new query window.</p></li>
<li class="task-list-item" id="taskIndex50"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex50"><span></span></label> Run the following query on  the global primary, which is the primary replica of the primary availability group, to display the health of the distributed availability group. </p>
<p>In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">SELECT 
    ag</span><span class="pun">.[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> AS </span><span class="pun">[</span><span class="typ">Distributed</span><span class="pln"> AG </span><span class="typ">Name</span><span class="pun">],</span><span class="pln"> 
    ag</span><span class="pun">.</span><span class="pln">is_distributed</span><span class="pun">,</span><span class="pln"> 
    ar</span><span class="pun">.</span><span class="pln">replica_server_name AS </span><span class="pun">[</span><span class="typ">Underlying</span><span class="pln"> AG</span><span class="pun">],</span><span class="pln"> 
    ars</span><span class="pun">.</span><span class="pln">role_desc AS </span><span class="pun">[</span><span class="typ">Role</span><span class="pun">],</span><span class="pln"> 
    ars</span><span class="pun">.</span><span class="pln">synchronization_health_desc AS </span><span class="pun">[</span><span class="typ">Sync</span><span class="pln"> </span><span class="typ">Status</span><span class="pun">]</span><span class="pln">
FROM  sys</span><span class="pun">.</span><span class="pln">availability_groups AS ag
INNER JOIN sys</span><span class="pun">.</span><span class="pln">availability_replicas AS ar 
    ON  ag</span><span class="pun">.</span><span class="pln">group_id </span><span class="pun">=</span><span class="pln"> ar</span><span class="pun">.</span><span class="pln">group_id        
INNER JOIN sys</span><span class="pun">.</span><span class="pln">dm_hadr_availability_replica_states AS ars       
    ON  ar</span><span class="pun">.</span><span class="pln">replica_id </span><span class="pun">=</span><span class="pln"> ars</span><span class="pun">.</span><span class="pln">replica_id
WHERE ag</span><span class="pun">.</span><span class="pln">is_distributed </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
GO</span></code></pre></li>
<li class="task-list-item" id="taskIndex51"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex51"><span></span></label> On the <strong>Results</strong> tab you should see two rows, one for each of the availability groups in the distributed availability group.  The <strong>Sync Status</strong> column shows the health of each availability group in the distributed availability group.  </p></li>
<li class="task-list-item" id="taskIndex52"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex52"><span></span></label> Repeat steps 2 and 3 to connect to <strong>AGCorpList</strong> and open a new query window.</p></li>
<li class="task-list-item" id="taskIndex53"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex53"><span></span></label> To further extend the previous query, you can also see the underlying performance via the dynamic management views by adding in <strong>sys.dm_hadr_database_replicas_states</strong>. The dynamic management view currently stores information about the second availability group only.</p></li>
<li class="task-list-item" id="taskIndex54"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex54"><span></span></label> Run the following query on  the global primary, which is the primary replica of the primary availability group, to display the performance of the distributed availability group. </p>
<p>In the query window that appears, type the following TSQL and press <strong>F5</strong> or click the <strong>Execute</strong> button to execute the script:</p>
<blockquote class="hint">
  <p>Open Notepad in the lab environment VM. Use the <strong><span class="typeText" title="Type Text">Type Text</span></strong> feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.</p>
</blockquote>
<pre><div class="codeTitle">TSQL</div><code class="TSQL language-TSQL prettyprint prettyprinted" style=""><span class="pln">SELECT 
    ag</span><span class="pun">.[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> AS </span><span class="pun">[</span><span class="typ">Distributed</span><span class="pln"> AG </span><span class="typ">Name</span><span class="pun">],</span><span class="pln"> 
    ar</span><span class="pun">.</span><span class="pln">replica_server_name AS </span><span class="pun">[</span><span class="typ">Underlying</span><span class="pln"> AG</span><span class="pun">],</span><span class="pln"> 
    dbs</span><span class="pun">.[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> AS </span><span class="pun">[</span><span class="typ">Database</span><span class="pun">],</span><span class="pln">
    ars</span><span class="pun">.</span><span class="pln">role_desc AS </span><span class="pun">[</span><span class="typ">Role</span><span class="pun">],</span><span class="pln">
    drs</span><span class="pun">.</span><span class="pln">synchronization_health_desc AS </span><span class="pun">[</span><span class="typ">Sync</span><span class="pln"> </span><span class="typ">Status</span><span class="pun">],</span><span class="pln">
    drs</span><span class="pun">.</span><span class="pln">log_send_queue_size</span><span class="pun">,</span><span class="pln">
    drs</span><span class="pun">.</span><span class="pln">log_send_rate</span><span class="pun">,</span><span class="pln"> 
    drs</span><span class="pun">.</span><span class="pln">redo_queue_size</span><span class="pun">,</span><span class="pln"> 
    drs</span><span class="pun">.</span><span class="pln">redo_rate
FROM sys</span><span class="pun">.</span><span class="pln">databases AS dbs
INNER JOIN sys</span><span class="pun">.</span><span class="pln">dm_hadr_database_replica_states AS drs
    ON dbs</span><span class="pun">.</span><span class="pln">database_id </span><span class="pun">=</span><span class="pln"> drs</span><span class="pun">.</span><span class="pln">database_id
INNER JOIN sys</span><span class="pun">.</span><span class="pln">availability_groups AS ag
    ON drs</span><span class="pun">.</span><span class="pln">group_id </span><span class="pun">=</span><span class="pln"> ag</span><span class="pun">.</span><span class="pln">group_id
INNER JOIN sys</span><span class="pun">.</span><span class="pln">dm_hadr_availability_replica_states AS ars
    ON ars</span><span class="pun">.</span><span class="pln">replica_id </span><span class="pun">=</span><span class="pln"> drs</span><span class="pun">.</span><span class="pln">replica_id
INNER JOIN sys</span><span class="pun">.</span><span class="pln">availability_replicas AS ar
    ON ar</span><span class="pun">.</span><span class="pln">replica_id </span><span class="pun">=</span><span class="pln"> ars</span><span class="pun">.</span><span class="pln">replica_id
WHERE ag</span><span class="pun">.</span><span class="pln">is_distributed </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
GO</span></code></pre></li>
<li class="task-list-item" id="taskIndex55"><p><label class="checkbox"><input type="checkbox" aria-labelledby="taskIndex55"><span></span></label> On the <strong>Results</strong> tab you should see two rows, one for each of the availability groups in the distributed availability group.  The columns for the secondary availability group show the performance of the distributed availability group, specifically the log send queue size and rate and redo queue size and rate. </p></li>
</ol>
<h3 id="congratulations-4">Congratulations!</h3>
<p>You have successfully completed this exercise. You can move to the next lab.</p></div></div>
    </div>
    <input type="hidden" id="rawContent" value="# Creating Distributed Availability Groups 

## Introduction

During this lab, you will learn how to create a distributed availability group using TSQL.

## Objectives

At the end of this lab, you will be able to:

- Validate all replicas have automatic seeding enabled
- Create the Distributed Availability Group
- Join a second AG to the DAG
- Validate the secondary AG has copies of the primary AG databases
- Failover a Distributed Availability Group 

## Estimated Time

35 minutes

## Logon Information

Use the following credentials to login into virtual environment

1. Connect to **@lab.VirtualMachine(AlwaysOnClient).SelectLink** as **+++@lab.VirtualMachine(AlwaysOnClient).Username+++** using **+++@lab.VirtualMachine(AlwaysOnClient).Password+++** as the password.

    &gt;[!TIP] Click the **+++Type Text+++** icon to enter the associated text into the virtual machine.

1. Connect to **@lab.VirtualMachine(AlwaysOnN1).SelectLink** as **+++@lab.VirtualMachine(AlwaysOnN1).Username+++** using **+++@lab.VirtualMachine(AlwaysOnN1).Password+++** as the password.

    &gt;[!TIP] Click the **+++Type Text+++** icon to enter the associated text into the virtual machine.

1. Connect to **@lab.VirtualMachine(AlwaysOnN2).SelectLink** as **+++@lab.VirtualMachine(AlwaysOnN2).Username+++** using **+++@lab.VirtualMachine(AlwaysOnN2).Password+++** as the password.

    &gt;[!TIP] Click the **+++Type Text+++** icon to enter the associated text into the virtual machine.

1. Connect to **@lab.VirtualMachine(AlwaysOnN3).SelectLink** as **+++@lab.VirtualMachine(AlwaysOnN3).Username+++** using **+++@lab.VirtualMachine(AlwaysOnN3).Password+++** as the password.

    &gt;[!TIP] Click the **+++Type Text+++** icon to enter the associated text into the virtual machine.

1. Connect to **@lab.VirtualMachine(AlwaysOnDC).SelectLink** as **+++@lab.VirtualMachine(AlwaysOnDC).Username+++** using **+++@lab.VirtualMachine(AlwaysOnDC).Password+++** as the password.

    &gt;[!TIP] Click the **+++Type Text+++** icon to enter the associated text into the virtual machine.

1. Change the screen resolution if required.

    &gt;[!TIP] You may want to adjust the screen resolution to your own preference. Do this by right-clicking on the desktop and choosing **Screen resolution** and clicking **OK** when finished.

&gt;[!note] Screenshots in the lab instructions may appear with a lesser SQL version number than is installed in the lab environment where functionality is not affected. 

===

# Exercise 1: Validate all replicas have automatic seeding enabled

In this exercise, you will learn how to validate all replicas have automatic seeding enabled

---

### Tasks

1. [] Login to the **@lab.VirtualMachine(AlwaysOnClient).SelectLink** virtual machine as +++**CORPNET\cluadmin+++** using **+++@lab.VirtualMachine(AlwaysOnClient).Password+++** as the password.

    &gt;[!TIP] Click the **+++Type Text+++** icon to enter the associated text into the virtual machine.

1. [] Open **SQL Server Management studio (SSMS)**, and then click **Connect**.

    ![](Media/image0185.png)

1. [] In **Registered servers**, expand **Database Engine** and navigate down to **Local Server Groups**

    ![](Media/image0186.png)

1. [] Right click **Local Server Groups** and select **New Query**.

    ![](Media/image0187.png)

1. [] A new query window will appear. 

    &gt;[!note] Notice the **pink** status bar at the bottom that says **Connected. (5/5)**. This means that whatever commands are issued in the query window, they will be executed to all five servers in the **Local Server Groups** list, namely: AlwaysOnN1 AlwaysOnN2 AlwaysOnN3 AlwaysOnN4 and AlwaysOnN5

    ![](Media/image0188.png)

1. [] Type in the following TSQL, and press the **F5** key to execute or press the **Execute** button. 

    &gt;[!note] This will query the **sys.availability_replicas** DMV to look at the seeding mode on all five replicas.

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    SELECT seeding_mode_desc
        FROM sys.availability_replicas
        WHERE replica_server_name = @@Servername
    ```

1. [] On the **Results** tab you should have 5 rows - one for each server. 

    &gt;[!knowledge] They should all indicate **AUTOMATIC** for their **seeding_mode_desc**. This is a requirement for distributed availability groups.

    ![](Media/image0189.png)

1. [] Next, close this query window.

1. [] When prompted to save the query, click **No**.


### Congratulations!

You have successfully completed this exercise. Click **Next** to advance to the next exercise.

===

# Exercise 2: Create the Distributed Availability Group

In this exercise, you will learn how to create the Distributed Availability Group

---

### Tasks

1. [] The next command needs to be executed on the primary replica of the &quot;Primary Availability Group&quot;. In this case the primary availability group is AGCorp. It is not always clear which instance is the primary, so we will connect to its primary using the availability group listener for that availability group, **AGCorpList**.

1. [] Click on the **Connect** button in the Object Explorer window as show in the screen caption. Select the **Database Engine** option.

    ![](Media/image0190.png)

1. [] Enter the name of the availability group listener, **+++AGCorpList+++** and press the **Connect** button.

    ![](Media/image0191.png)

1. [] Find **AGCorpList** in the list of instances in the Object Explorer, right click it and select **New Query**

    ![](Media/image0192.png)

1. [] In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    CREATE AVAILABILITY GROUP [AGCorpDistributed]
        WITH (DISTRIBUTED) AVAILABILITY GROUP ON
        &#39;AGCorp&#39; WITH (
            LISTENER_URL = &#39;tcp://AGCorpList.corpnet.contoso.com:5022&#39;,
            AVAILABILITY_MODE = ASYNCHRONOUS_COMMIT,
            FAILOVER_MODE = MANUAL,
            SEEDING_MODE = AUTOMATIC),
        &#39;AGCorpDR&#39; WITH (
            LISTENER_URL = &#39;tcp://AGCorpDRList.corpnet.contoso.com:5022&#39;,
            AVAILABILITY_MODE = ASYNCHRONOUS_COMMIT,
            FAILOVER_MODE = MANUAL,
            SEEDING_MODE = AUTOMATIC);
    GO
    ```

    Alternatively, you can open the file, **CreateDAG.SQL** located in the following path on the AlwaysOnClient virtual machine. **Make sure the file is connected to AGCorpList**.
    
    **C:\Scripts\ Lab 06 – Creating Distributed Availability Groups**
    
    ![image0193.png](Media/image0193.png)

    &gt;[!note] The port used for each distributed availability group LISTENER_URL (in this example 5022 for both) is the same port that the mirroring endpoint is configured to listen on, not the port that the availability group listener listens on for client communications.  The LISTENER_URL tells the primary availability group where to send its traffic to the secondary availability group.

1. [] Verify the Messages tab indicated the commands completed successfully.

    ![](Media/image0194.png)

### Congratulations!

You have successfully completed this exercise. Click **Next** to advance to the next exercise.

===

# Exercise 3: Join a second availability group to the distributed availability group

In this exercise, you will learn how to join a second availability group to the distributed availability group

---

### Tasks

1. [] For direct seeding, you must allow database creation on each secondary replica by calling ALTER AVAILABILITY GROUP with the GRANT CREATE ANY DATABASE option. In our case the secondary availability group is **AGCorpDR** and secondary replica is **AlwaysOnN5**. **Connect** to **AlwaysonN5** and in **new query window** execute the command 

    +++ALTER AVAILABILITY GROUP AGCorpDR GRANT CREATE ANY DATABASE+++

1. [] The next command needs to be executed onto the **primary** replica of the &quot;Secondary Availability Group&quot; i.e. **AGCorpDR**. Connect to its primary replica using the availability group **listener** for that availability group, **AGCorpDRList**.

1. [] Click on the **Connect** button in the Object Explorer window as show in the screen caption. Select the **Database Engine** option.

    ![](Media/image0190.png)

1. [] Enter the name of the availability group listener, +++**AGCorpDRList**+++ and press the **Connect** button.

    ![](Media/image0195.png)

1. [] Find **AGCorpDRList** in the list of instances in the Object Explorer, right click it and select **New Query**.

    ![image0196.png](Media/image0196.png)

1. [] In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    ALTER AVAILABILITY GROUP [AGCorpDistributed]
    JOIN AVAILABILITY GROUP ON
    &#39;AGCorp&#39; WITH (
        LISTENER_URL = &#39;tcp://AGCorpList.corpnet.contoso.com:5022&#39;,
        AVAILABILITY_MODE = ASYNCHRONOUS_COMMIT,
        FAILOVER_MODE = MANUAL,
        SEEDING_MODE = AUTOMATIC),
    &#39;AGCorpDR&#39; WITH (
        LISTENER_URL = &#39;tcp://AGCorpDRList.corpnet.contoso.com:5022&#39;,
        AVAILABILITY_MODE = ASYNCHRONOUS_COMMIT,
        FAILOVER_MODE = MANUAL,
        SEEDING_MODE = AUTOMATIC);
    GO
    ```
    
    Alternatively, you can open the file, **JoinDAG.SQL** located in the following path on the AlwaysOnClient virtual machine. **Make sure the file is connected to AGCorpDRList**.
    
    **C:\Scripts\ Lab 06 – Creating Distributed Availability Groups**
    
    ![image0197.png](Media/image0197.png)

1. [] Verify the Messages tab indicated the commands completed successfully.

1. [] Now verify the distributed availability group exists. Re-connect to **AGCorpList** in SSMS Object Explorer and navigate to **Availability Groups**.

    Notice two things;

    1. Next to the availability group called **AGCorpDistributed**, it shows **(Distributed)**

    1. Under the Availability Replicas for the distributed AG, it shows a **primary** and a **secondary** **Availability Group** name, not replica server names.

        ![image0198.png](Media/image0198.png)

### Congratulations!

You have successfully completed this exercise. Click **Next** to advance to the next exercise.

===

# Exercise 4: Validate the secondary AG has copies of the primary AG databases

In this exercise, you will learn how to validate the secondary AG has copies of the primary AG databases

---

### Tasks

1. [] At the end of exercise 3, we joined the secondary availability group to the distributed availability group. Now we need to confirm the nodes in this availability group receive the databases that the primary availability group has.

1. [] Connect to one of the two nodes in the secondary availability group, **AlwaysOnN4**.

    Click on the **Connect** button in the Object Explorer window as show in the screen caption. Select the **Database Engine** option.

    ![](Media/image0190.png)

1. [] Enter the name of the replica in the secondary availability group, +++**AlwaysOnN4**+++ and press the **Connect** button.

    ![](Media/image0199.png)

1. [] Find **AlwaysOnN4** in the list of instances in the Object Explorer and navigate down to the **Databases** folder and expand it.

    ![image0200.png](Media/image0200.png)

    &gt;[!note] Depending on how long it takes you to open the connection to primary of the secondary AG , the state of the two databases highlighted could be &quot;Synchronized&quot;, &quot;Synchronizing&quot;, or &quot;Not Synchronizing&quot;. Eventually they should show &quot;Synchronized&quot; as in the screen shot above.

1. [] Repeat steps 2 through 4 for +++**AlwaysOnN5**+++. It should also show the two new databases, **AdventureWorks** and **AdventureWorksDW**.

    ![image0201.png](Media/image0201.png)

1. [] What is the state of the two databases on AlwaysOnN5?     

    @lab.TextBox(AlwaysOnN5DatabaseState)    

    @lab.Variable(AlwaysOnN5DatabaseState)

    If different than AlwaysOnN4, can you explain why?  

    @lab.TextBox(DatabaseStateDifferences)    

    @lab.Variable(DatabaseStateDifferences)

    &gt;[!note]In some cases, one of the databases may not get automatically created or ever reach a synchronized state. If that is the case, you can review the SQL Server error logs or the following DMVs in a query window:

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    SELECT * FROM sys.dm_hadr_physical_seeding_stats
    SELECT * FROM sys.dm_hadr_automatic_seeding
    ```

### Congratulations!

You have successfully completed this exercise. Click **Next** to advance to the next exercise.

===

# Exercise 5: Failover distributed availability group

In this exercise, you will learn how to failover distributed availability group

---

### Tasks

1. [] In the last exercise we verified the secondary availability group has copied our databases from the primary availability group and the databases are synchronized.  In this exercise we will failover from the primary availability group to the secondary availabilty group. 

    This next command needs to be executed on both the global primary, **AGCorpList**, and the forwarder, **AGCorpDRList**, to switch the distributed availability group to synchronous commit. 

1. [] Connect to the listener for the primary availability group, **AGCorpList**.

    Click on the **Connect** button in the Object Explorer window as show in the screen caption. Select the **Database Engine** option.

    ![](Media/image0190.png)

1. [] Enter the name of the availability group listener, +++**AGCorpList**+++ and press the **Connect** button.

    ![](Media/image0191.png)

1. [] Find **AGCorpList** in the list of instances in the Object Explorer, right click it and select **New Query**

    ![](Media/image0192.png)

1. [] In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    -- sets the distributed availability group to synchronous commit 
    ALTER AVAILABILITY GROUP [AGCorpDistributed] 
    MODIFY 
    AVAILABILITY GROUP ON
    &#39;AGCorp&#39; WITH 
    ( 
    AVAILABILITY_MODE = SYNCHRONOUS_COMMIT 
    ), 
    &#39;AGCorpDR&#39; WITH  
    ( 
    AVAILABILITY_MODE = SYNCHRONOUS_COMMIT 
    );
    GO
    ```

    Alternatively, you can open the file, **SetDAGSynchronous.SQL** located in the following path on the AlwaysOnClient virtual machine. **Make sure the file is connected to AGCorpList**.
    
    **C:\Scripts\ Lab 06 – Creating Distributed Availability Groups**
    
    ![image0202.png](Media/image0202.png)

    &gt;[!Note]In a distributed availability group, the synchronization status between the two availability groups depends on the availability mode of both replicas. For synchronous commit mode, both the current primary availability group, and the current secondary availability group must have SYNCHRONOUS_COMMIT availability mode. For this reason, you must run the script above on both the global primary replica, and the forwarder.

1. [] Verify the Messages tab indicated the commands completed successfully.

1. []  Repeat steps 2 through 6 for +++**AGCorpDRList**+++ to set the secondary availability group to synchronous commit mode.

1. [] Open a new query window and make sure you are connected to **AGCorpList**. 

1. [] On the global primary set the availability group role to secondary. 

    In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script: 

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    ALTER AVAILABILITY GROUP AGCorpDistributed SET (ROLE = SECONDARY);
    GO
    ```

1. [] Verify the Messages tab indicated the commands completed successfully.

1. [] Wait until the status of the distributed availability group has changed to SYNCHRONIZED and all replicas have the same last_hardened_lsn (per database). 

    Run the following query on both the global primary, which is the primary replica of the primary availability group, and the forwarder to check the synchronization_state_desc and last_hardened_lsn:

    In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:
    
    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
     -- Run this query on the Global Primary and the forwarder
    -- Check the results to see if synchronization_state_desc is SYNCHRONIZED, and the last_hardened_lsn is the same per      database on both the global primary and forwarder 
    -- If not rerun the query on both side every 5 seconds until it is the case
    --
    SELECT ag.name
       , drs.database_id
       , db_name(drs.database_id) as database_name
       , drs.group_id
       , r.replica_server_name as replica_name
       , drs.synchronization_state_desc
       , drs.last_hardened_lsn  
    FROM sys.dm_hadr_database_replica_states drs 
    INNER JOIN sys.availability_groups ag 
        ON drs.group_id = ag.group_id
    INNER JOIN sys.availability_replicas r 
        ON drs.replica_id = r.replica_id;
    GO
    ```

    Alternatively, you can open the file, **CheckLastHardenedLSN.SQL** located in the following path on the AlwaysOnClient virtual machine. **Make sure you run the  file connected to AGCorpList**.
    
    **C:\Scripts\ Lab 06 – Creating Distributed Availability Groups**
    
    ![image0203.png](Media/image0203.png)

1. [] Verify the Messages tab indicated the commands completed successfully.

1. [] Repeat step 11 thru 13 for +++**AGCorpDRList**+++

1. [] Now that the distributed availability group is synchronized and all availability replicas have the same last_hardened_lsn we are ready to failover the distributed availability group. 

    Find **AGCorpDRList** in the list of instances in the Object Explorer, right click it and select **New Query**.

    ![image0196.png](Media/image0196.png)

1. [] In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.
    
    ```TSQL
    ALTER AVAILABILITY GROUP AGCorpDistributed FORCE_FAILOVER_ALLOW_DATA_LOSS;
    GO
    ```

    After completing the steps above, the distributed availability group fails over without any data loss. If the availability groups are across a geographical distance that causes latency, change the availability mode back to **ASYNCHRONOUS_COMMIT**.  
   
    To fail the distributed availability group back from AGCorpDistributed to AGCorpList repeat the above steps. 
 
 ### Congratulations!

You have successfully completed this exercise. Click **Next** to advance to the next exercise.

===

# Exercise 6: Monitor distributed availability group health

In this exercise, you will learn how to monitor distributed availability group health

---

### Tasks

1. [] In exercise 4, we set the distributed availability group in synchronous commit mode and failed over to the secondary availability group.  In this exercise we will monitor the health of our distributed availability group.  

    The distributed availability group is SQL Server-only-construct and is not seen in the WSFC cluster.  Also, in SQL Server Management Studio you will only see the existence of the distributed availability group and its replicas. The availability databases and availability group listeners are all empty.  This may change in future versions of Management Studio but for now we will monitor the health of our availability group using T-SQL scripts. 

1. [] Connect to the listener for the primary availability group, **AGCorpList**.

    Click on the **Connect** button in the Object Explorer window as show in the screen caption. Select the **Database Engine** option.

    ![](Media/image0190.png)

1. [] Enter the name of the availability group listener, +++**AGCorpList**+++ and press the **Connect** button.

    ![](Media/image0191.png)1. [] Find **AGCorpList** in the list of instances in the Object Explorer, right click it and select **New Query**

    ![](Media/image0192.png)

1. [] In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:

    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    SELECT 
        ag.[name] AS [Distributed AG Name], 
        ag.Is_Distributed, 
        ar.replica_server_name AS [Replica Name]
    FROM sys.availability_groups AS ag 
    INNER JOIN sys.availability_replicas AS ar       
        ON ag.group_id = ar.group_id
    WHERE ag.Is_Distributed = 1 
    GO
    ```

1. [] On the **Results** tab you should see two rows listing the name of your distributed availability group and the names of the replicas in the distributed availability group.

1. [] Repeat steps 2 and 3 to connect to **AGCorpList** and open a new query window.

1. [] Run the following query on  the global primary, which is the primary replica of the primary availability group, to display the health of the distributed availability group. 

    In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:
    
    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    SELECT 
        ag.[name] AS [Distributed AG Name], 
        ag.is_distributed, 
        ar.replica_server_name AS [Underlying AG], 
        ars.role_desc AS [Role], 
        ars.synchronization_health_desc AS [Sync Status]
    FROM  sys.availability_groups AS ag
    INNER JOIN sys.availability_replicas AS ar 
        ON  ag.group_id = ar.group_id        
    INNER JOIN sys.dm_hadr_availability_replica_states AS ars       
        ON  ar.replica_id = ars.replica_id
    WHERE ag.is_distributed = 1
    GO
    ```

1. [] On the **Results** tab you should see two rows, one for each of the availability groups in the distributed availability group.  The **Sync Status** column shows the health of each availability group in the distributed availability group.  

1. [] Repeat steps 2 and 3 to connect to **AGCorpList** and open a new query window.

1. [] To further extend the previous query, you can also see the underlying performance via the dynamic management views by adding in **sys.dm_hadr_database_replicas_states**. The dynamic management view currently stores information about the second availability group only.

1. [] Run the following query on  the global primary, which is the primary replica of the primary availability group, to display the performance of the distributed availability group. 

    In the query window that appears, type the following TSQL and press **F5** or click the **Execute** button to execute the script:
    
    &gt;[!TIP] Open Notepad in the lab environment VM. Use the **+++Type Text+++** feature to enter the code into Notepad, copy the code, and then paste it into the Query Editor. This will bypass the autocomplete features in the Query Editor.

    ```TSQL
    SELECT 
        ag.[name] AS [Distributed AG Name], 
        ar.replica_server_name AS [Underlying AG], 
        dbs.[name] AS [Database],
        ars.role_desc AS [Role],
        drs.synchronization_health_desc AS [Sync Status],
        drs.log_send_queue_size,
        drs.log_send_rate, 
        drs.redo_queue_size, 
        drs.redo_rate
    FROM sys.databases AS dbs
    INNER JOIN sys.dm_hadr_database_replica_states AS drs
        ON dbs.database_id = drs.database_id
    INNER JOIN sys.availability_groups AS ag
        ON drs.group_id = ag.group_id
    INNER JOIN sys.dm_hadr_availability_replica_states AS ars
        ON ars.replica_id = drs.replica_id
    INNER JOIN sys.availability_replicas AS ar
        ON ar.replica_id = ars.replica_id
    WHERE ag.is_distributed = 1
    GO
    ```

1. [] On the **Results** tab you should see two rows, one for each of the availability groups in the distributed availability group.  The columns for the secondary availability group show the performance of the distributed availability group, specifically the log send queue size and rate and redo queue size and rate. 

### Congratulations!

You have successfully completed this exercise. You can move to the next lab.
">
    <input type="hidden" id="activities" value="[]">
    <input type="hidden" id="activityGroups" value="[]">
    <input type="hidden" id="replacementTokens" value="[{&quot;Token&quot;:&quot;@lab.LabProfile.Id&quot;,&quot;Replacement&quot;:&quot;162361&quot;},{&quot;Token&quot;:&quot;@lab.CtrlAltDelete&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;ctrlAltDeleteLink icon-link special-action-link&#39;&gt;Ctrl+Alt+Delete&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnDC).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink icon-link special-action-link&#39; data-data=&#39;252934&#39;&gt;AlwaysOnDC&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnDC).Username&quot;,&quot;Replacement&quot;:&quot;Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnDC).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnDC).Console&quot;,&quot;Replacement&quot;:&quot;&lt;div class=&#39;virtual-machine-console&#39; data-id=&#39;252934&#39; data-height=&#39;768&#39; data-width=&#39;1024&#39;&gt;&lt;/div&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnDC).NewWindowLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;open-in-new-window-link icon-link special-action-link machine-new-window-link&#39; data-data=&#39;252934&#39;&gt;AlwaysOnDC&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN1).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink icon-link special-action-link&#39; data-data=&#39;252935&#39;&gt;AlwaysOnN1&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN1).Username&quot;,&quot;Replacement&quot;:&quot;CORPNET.CONTOSO.COM\\Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN1).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN1).Console&quot;,&quot;Replacement&quot;:&quot;&lt;div class=&#39;virtual-machine-console&#39; data-id=&#39;252935&#39; data-height=&#39;768&#39; data-width=&#39;1024&#39;&gt;&lt;/div&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN1).NewWindowLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;open-in-new-window-link icon-link special-action-link machine-new-window-link&#39; data-data=&#39;252935&#39;&gt;AlwaysOnN1&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN2).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink icon-link special-action-link&#39; data-data=&#39;252936&#39;&gt;AlwaysOnN2&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN2).Username&quot;,&quot;Replacement&quot;:&quot;Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN2).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN2).Console&quot;,&quot;Replacement&quot;:&quot;&lt;div class=&#39;virtual-machine-console&#39; data-id=&#39;252936&#39; data-height=&#39;768&#39; data-width=&#39;1024&#39;&gt;&lt;/div&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN2).NewWindowLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;open-in-new-window-link icon-link special-action-link machine-new-window-link&#39; data-data=&#39;252936&#39;&gt;AlwaysOnN2&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN3).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink icon-link special-action-link&#39; data-data=&#39;252937&#39;&gt;AlwaysOnN3&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN3).Username&quot;,&quot;Replacement&quot;:&quot;Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN3).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN3).Console&quot;,&quot;Replacement&quot;:&quot;&lt;div class=&#39;virtual-machine-console&#39; data-id=&#39;252937&#39; data-height=&#39;768&#39; data-width=&#39;1024&#39;&gt;&lt;/div&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN3).NewWindowLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;open-in-new-window-link icon-link special-action-link machine-new-window-link&#39; data-data=&#39;252937&#39;&gt;AlwaysOnN3&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnClient).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink icon-link special-action-link&#39; data-data=&#39;252938&#39;&gt;AlwaysOnClient&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnClient).Username&quot;,&quot;Replacement&quot;:&quot;Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnClient).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnClient).Console&quot;,&quot;Replacement&quot;:&quot;&lt;div class=&#39;virtual-machine-console&#39; data-id=&#39;252938&#39; data-height=&#39;768&#39; data-width=&#39;1024&#39;&gt;&lt;/div&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnClient).NewWindowLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;open-in-new-window-link icon-link special-action-link machine-new-window-link&#39; data-data=&#39;252938&#39;&gt;AlwaysOnClient&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN4).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink icon-link special-action-link&#39; data-data=&#39;252939&#39;&gt;AlwaysOnN4&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN4).Username&quot;,&quot;Replacement&quot;:&quot;CORPNET.CONTOSO.COM\\Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN4).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN4).Console&quot;,&quot;Replacement&quot;:&quot;&lt;div class=&#39;virtual-machine-console&#39; data-id=&#39;252939&#39; data-height=&#39;768&#39; data-width=&#39;1024&#39;&gt;&lt;/div&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN4).NewWindowLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;open-in-new-window-link icon-link special-action-link machine-new-window-link&#39; data-data=&#39;252939&#39;&gt;AlwaysOnN4&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN5).SelectLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;selectMachineLink icon-link special-action-link&#39; data-data=&#39;252940&#39;&gt;AlwaysOnN5&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN5).Username&quot;,&quot;Replacement&quot;:&quot;CORPNET.CONTOSO.COM\\Administrator&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN5).Password&quot;,&quot;Replacement&quot;:&quot;Pa$$$$w0rd&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN5).Console&quot;,&quot;Replacement&quot;:&quot;&lt;div class=&#39;virtual-machine-console&#39; data-id=&#39;252940&#39; data-height=&#39;768&#39; data-width=&#39;1024&#39;&gt;&lt;/div&gt;&quot;},{&quot;Token&quot;:&quot;@lab.VirtualMachine(AlwaysOnN5).NewWindowLink&quot;,&quot;Replacement&quot;:&quot;&lt;a href=&#39;#&#39; class=&#39;open-in-new-window-link icon-link special-action-link machine-new-window-link&#39; data-data=&#39;252940&#39;&gt;AlwaysOnN5&lt;/a&gt;&quot;},{&quot;Token&quot;:&quot;@lab.Title&quot;,&quot;Replacement&quot;:&quot;&lt;h1 class=\&quot;lab-title primary-color\&quot;&gt;Creating Distributed Availability Groups&lt;/h1&gt;&quot;},{&quot;Token&quot;:&quot;@lab.LanguageName&quot;,&quot;Replacement&quot;:&quot;English&quot;},{&quot;Token&quot;:&quot;@lab.LanguageCode&quot;,&quot;Replacement&quot;:&quot;en&quot;},{&quot;Token&quot;:&quot;@lab.LanguageRegionCode&quot;,&quot;Replacement&quot;:&quot;en-US&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.Id&quot;,&quot;Replacement&quot;:&quot;{LAB_INSTANCE_ID}&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.GlobalId&quot;,&quot;Replacement&quot;:&quot;{lod_LAB_INSTANCE_ID}&quot;},{&quot;Token&quot;:&quot;@lab.LabInstance.StartDate&quot;,&quot;Replacement&quot;:&quot;20240328&quot;},{&quot;Token&quot;:&quot;@lab.User.Id&quot;,&quot;Replacement&quot;:&quot;{USER_ID}&quot;},{&quot;Token&quot;:&quot;@lab.User.FirstName&quot;,&quot;Replacement&quot;:&quot;{USER_FIRSTNAME}&quot;},{&quot;Token&quot;:&quot;@lab.User.LastName&quot;,&quot;Replacement&quot;:&quot;{USER_LASTNAME}&quot;},{&quot;Token&quot;:&quot;@lab.User.Email&quot;,&quot;Replacement&quot;:&quot;{EMAIL}&quot;},{&quot;Token&quot;:&quot;@lab.User.ExternalId&quot;,&quot;Replacement&quot;:&quot;{USER_EXTERNALID}&quot;},{&quot;Token&quot;:&quot;@lab.User.Organization.Id&quot;,&quot;Replacement&quot;:&quot;{USER_ORGANIZATION_ID}&quot;},{&quot;Token&quot;:&quot;@lab.User.Organization.Name&quot;,&quot;Replacement&quot;:&quot;{USER_ORGANIZATION_NAME}&quot;},{&quot;Token&quot;:&quot;@lab.Tag&quot;,&quot;Replacement&quot;:&quot;{TAG}&quot;}]">
    <input type="hidden" id="replacements">
    <input type="hidden" id="variables">

    <textarea id="copyInput" value="" style="position: absolute; left:-10000px; top:-10000px; " spellcheck="false" data-ms-editor="true"></textarea>

    <div id="Model" data-id="162361" data-contentroot="https://labondemand.blob.core.windows.net/content/lab162361/" data-scrolltop="" data-themescript="">



</div></body><editor-card style="position:absolute;top:0px;left:0px;z-index:auto;display: block !important"><div dir="ltr" style="all: initial;"><div style="color: initial; font: initial; font-palette: initial; font-synthesis: initial; forced-color-adjust: initial; position: absolute; text-orientation: initial; text-rendering: initial; text-spacing-trim: initial; -webkit-font-smoothing: initial; -webkit-locale: initial; -webkit-text-orientation: initial; -webkit-writing-mode: initial; writing-mode: initial; zoom: initial; accent-color: initial; place-content: initial; place-items: initial; place-self: initial; alignment-baseline: initial; animation-composition: initial; animation: initial; app-region: initial; appearance: initial; aspect-ratio: initial; backdrop-filter: initial; backface-visibility: initial; background: initial; background-blend-mode: initial; baseline-shift: initial; baseline-source: initial; block-size: initial; border-block: initial; border: initial; border-radius: initial; border-collapse: initial; border-end-end-radius: initial; border-end-start-radius: initial; border-inline: initial; border-start-end-radius: initial; border-start-start-radius: initial; inset: initial; box-shadow: initial; box-sizing: initial; break-after: initial; break-before: initial; break-inside: initial; buffered-rendering: initial; caption-side: initial; caret-color: initial; clear: initial; clip: initial; clip-path: initial; clip-rule: initial; color-interpolation: initial; color-interpolation-filters: initial; color-rendering: initial; color-scheme: initial; columns: initial; column-fill: initial; gap: initial; column-rule: initial; column-span: initial; contain: initial; contain-intrinsic-block-size: initial; contain-intrinsic-size: initial; contain-intrinsic-inline-size: initial; container: initial; content: initial; content-visibility: initial; counter-increment: initial; counter-reset: initial; counter-set: initial; cursor: initial; cx: initial; cy: initial; d: initial; display: initial; dominant-baseline: initial; empty-cells: initial; field-sizing: initial; fill: initial; fill-opacity: initial; fill-rule: initial; filter: initial; flex: initial; flex-flow: initial; float: initial; flood-color: initial; flood-opacity: initial; grid: initial; grid-area: initial; height: initial; hyphenate-character: initial; hyphenate-limit-chars: initial; hyphens: initial; image-orientation: initial; image-rendering: initial; initial-letter: initial; inline-size: initial; inset-block: initial; inset-inline: initial; isolation: initial; letter-spacing: initial; lighting-color: initial; line-break: initial; list-style: initial; margin-block: initial; margin: initial; margin-inline: initial; marker: initial; mask: initial; mask-type: initial; math-depth: initial; math-shift: initial; math-style: initial; max-block-size: initial; max-height: initial; max-inline-size: initial; max-width: initial; min-block-size: initial; min-height: initial; min-inline-size: initial; min-width: initial; mix-blend-mode: initial; object-fit: initial; object-position: initial; object-view-box: initial; offset: initial; opacity: initial; order: initial; orphans: initial; outline: initial; outline-offset: initial; overflow-anchor: initial; overflow-clip-margin: initial; overflow-wrap: initial; overflow: initial; overlay: initial; overscroll-behavior-block: initial; overscroll-behavior-inline: initial; overscroll-behavior: initial; padding-block: initial; padding: initial; padding-inline: initial; page: initial; page-orientation: initial; paint-order: initial; perspective: initial; perspective-origin: initial; pointer-events: initial; quotes: initial; r: initial; resize: initial; rotate: initial; ruby-position: initial; rx: initial; ry: initial; scale: initial; scroll-behavior: initial; scroll-margin-block: initial; scroll-margin: initial; scroll-margin-inline: initial; scroll-padding-block: initial; scroll-padding: initial; scroll-padding-inline: initial; scroll-snap-align: initial; scroll-snap-stop: initial; scroll-snap-type: initial; scroll-timeline: initial; scrollbar-color: initial; scrollbar-gutter: initial; scrollbar-width: initial; shape-image-threshold: initial; shape-margin: initial; shape-outside: initial; shape-rendering: initial; size: initial; speak: initial; stop-color: initial; stop-opacity: initial; stroke: initial; stroke-dasharray: initial; stroke-dashoffset: initial; stroke-linecap: initial; stroke-linejoin: initial; stroke-miterlimit: initial; stroke-opacity: initial; stroke-width: initial; tab-size: initial; table-layout: initial; text-align: initial; text-align-last: initial; text-anchor: initial; text-combine-upright: initial; text-decoration: initial; text-decoration-skip-ink: initial; text-emphasis: initial; text-emphasis-position: initial; text-indent: initial; text-overflow: initial; text-shadow: initial; text-size-adjust: initial; text-transform: initial; text-underline-offset: initial; text-underline-position: initial; white-space: initial; timeline-scope: initial; touch-action: initial; transform: initial; transform-box: initial; transform-origin: initial; transform-style: initial; transition: initial; translate: initial; user-select: initial; vector-effect: initial; vertical-align: initial; view-timeline: initial; view-transition-name: initial; visibility: initial; border-spacing: initial; -webkit-box-align: initial; -webkit-box-decoration-break: initial; -webkit-box-direction: initial; -webkit-box-flex: initial; -webkit-box-ordinal-group: initial; -webkit-box-orient: initial; -webkit-box-pack: initial; -webkit-box-reflect: initial; -webkit-line-break: initial; -webkit-line-clamp: initial; -webkit-mask-box-image: initial; -webkit-print-color-adjust: initial; -webkit-rtl-ordering: initial; -webkit-ruby-position: initial; -webkit-tap-highlight-color: initial; -webkit-text-combine: initial; -webkit-text-decorations-in-effect: initial; -webkit-text-fill-color: initial; -webkit-text-security: initial; -webkit-text-stroke: initial; -webkit-user-drag: initial; widows: initial; width: initial; will-change: initial; word-break: initial; word-spacing: initial; x: initial; y: initial; z-index: 2147483647;"><link rel="stylesheet" href="chrome-extension://hokifickgkhplphjiodbggjmoafhignh/fonts/fabric-icons.css"><div style="all: initial;"><template shadowrootmode="open"></template></div></div><div style="color: initial; font: initial; font-palette: initial; font-synthesis: initial; forced-color-adjust: initial; position: absolute; text-orientation: initial; text-rendering: initial; text-spacing-trim: initial; -webkit-font-smoothing: initial; -webkit-locale: initial; -webkit-text-orientation: initial; -webkit-writing-mode: initial; writing-mode: initial; zoom: initial; accent-color: initial; place-content: initial; place-items: initial; place-self: initial; alignment-baseline: initial; animation-composition: initial; animation: initial; app-region: initial; appearance: initial; aspect-ratio: initial; backdrop-filter: initial; backface-visibility: initial; background: initial; background-blend-mode: initial; baseline-shift: initial; baseline-source: initial; block-size: initial; border-block: initial; border: initial; border-radius: initial; border-collapse: initial; border-end-end-radius: initial; border-end-start-radius: initial; border-inline: initial; border-start-end-radius: initial; border-start-start-radius: initial; inset: initial; box-shadow: initial; box-sizing: initial; break-after: initial; break-before: initial; break-inside: initial; buffered-rendering: initial; caption-side: initial; caret-color: initial; clear: initial; clip: initial; clip-path: initial; clip-rule: initial; color-interpolation: initial; color-interpolation-filters: initial; color-rendering: initial; color-scheme: initial; columns: initial; column-fill: initial; gap: initial; column-rule: initial; column-span: initial; contain: initial; contain-intrinsic-block-size: initial; contain-intrinsic-size: initial; contain-intrinsic-inline-size: initial; container: initial; content: initial; content-visibility: initial; counter-increment: initial; counter-reset: initial; counter-set: initial; cursor: initial; cx: initial; cy: initial; d: initial; display: initial; dominant-baseline: initial; empty-cells: initial; field-sizing: initial; fill: initial; fill-opacity: initial; fill-rule: initial; filter: initial; flex: initial; flex-flow: initial; float: initial; flood-color: initial; flood-opacity: initial; grid: initial; grid-area: initial; height: initial; hyphenate-character: initial; hyphenate-limit-chars: initial; hyphens: initial; image-orientation: initial; image-rendering: initial; initial-letter: initial; inline-size: initial; inset-block: initial; inset-inline: initial; isolation: initial; letter-spacing: initial; lighting-color: initial; line-break: initial; list-style: initial; margin-block: initial; margin: initial; margin-inline: initial; marker: initial; mask: initial; mask-type: initial; math-depth: initial; math-shift: initial; math-style: initial; max-block-size: initial; max-height: initial; max-inline-size: initial; max-width: initial; min-block-size: initial; min-height: initial; min-inline-size: initial; min-width: initial; mix-blend-mode: initial; object-fit: initial; object-position: initial; object-view-box: initial; offset: initial; opacity: initial; order: initial; orphans: initial; outline: initial; outline-offset: initial; overflow-anchor: initial; overflow-clip-margin: initial; overflow-wrap: initial; overflow: initial; overlay: initial; overscroll-behavior-block: initial; overscroll-behavior-inline: initial; overscroll-behavior: initial; padding-block: initial; padding: initial; padding-inline: initial; page: initial; page-orientation: initial; paint-order: initial; perspective: initial; perspective-origin: initial; pointer-events: initial; quotes: initial; r: initial; resize: initial; rotate: initial; ruby-position: initial; rx: initial; ry: initial; scale: initial; scroll-behavior: initial; scroll-margin-block: initial; scroll-margin: initial; scroll-margin-inline: initial; scroll-padding-block: initial; scroll-padding: initial; scroll-padding-inline: initial; scroll-snap-align: initial; scroll-snap-stop: initial; scroll-snap-type: initial; scroll-timeline: initial; scrollbar-color: initial; scrollbar-gutter: initial; scrollbar-width: initial; shape-image-threshold: initial; shape-margin: initial; shape-outside: initial; shape-rendering: initial; size: initial; speak: initial; stop-color: initial; stop-opacity: initial; stroke: initial; stroke-dasharray: initial; stroke-dashoffset: initial; stroke-linecap: initial; stroke-linejoin: initial; stroke-miterlimit: initial; stroke-opacity: initial; stroke-width: initial; tab-size: initial; table-layout: initial; text-align: initial; text-align-last: initial; text-anchor: initial; text-combine-upright: initial; text-decoration: initial; text-decoration-skip-ink: initial; text-emphasis: initial; text-emphasis-position: initial; text-indent: initial; text-overflow: initial; text-shadow: initial; text-size-adjust: initial; text-transform: initial; text-underline-offset: initial; text-underline-position: initial; white-space: initial; timeline-scope: initial; touch-action: initial; transform: initial; transform-box: initial; transform-origin: initial; transform-style: initial; transition: initial; translate: initial; user-select: initial; vector-effect: initial; vertical-align: initial; view-timeline: initial; view-transition-name: initial; visibility: initial; border-spacing: initial; -webkit-box-align: initial; -webkit-box-decoration-break: initial; -webkit-box-direction: initial; -webkit-box-flex: initial; -webkit-box-ordinal-group: initial; -webkit-box-orient: initial; -webkit-box-pack: initial; -webkit-box-reflect: initial; -webkit-line-break: initial; -webkit-line-clamp: initial; -webkit-mask-box-image: initial; -webkit-print-color-adjust: initial; -webkit-rtl-ordering: initial; -webkit-ruby-position: initial; -webkit-tap-highlight-color: initial; -webkit-text-combine: initial; -webkit-text-decorations-in-effect: initial; -webkit-text-fill-color: initial; -webkit-text-security: initial; -webkit-text-stroke: initial; -webkit-user-drag: initial; widows: initial; width: initial; will-change: initial; word-break: initial; word-spacing: initial; x: initial; y: initial; z-index: 2147483647;"><link rel="stylesheet" href="chrome-extension://hokifickgkhplphjiodbggjmoafhignh/fonts/fabric-icons.css"></div></div></editor-card></html>